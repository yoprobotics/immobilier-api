<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Napkin Multi | ImmoCalcul</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="../index.html">ImmoCalcul</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Accueil</a></li>
                    <li class="nav-item"><a class="nav-link active" href="../index.html#calculators">Calculateurs</a></li>
                    <li class="nav-item"><a class="nav-link" href="../index.html#about">À propos</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="calculator-nav container py-3">
        <div class="calculator-nav-item" onclick="window.location.href='flip-napkin.html'">
            <i class="fas fa-calculator"></i> Napkin Flip
        </div>
        <div class="calculator-nav-item" onclick="window.location.href='flip-offer.html'">
            <i class="fas fa-hand-holding-usd"></i> Offre Flip
        </div>
        <div class="calculator-nav-item active" onclick="window.location.href='multi-napkin.html'">
            <i class="fas fa-building"></i> Napkin Multi
        </div>
        <div class="calculator-nav-item" onclick="window.location.href='renovation-cost.html'">
            <i class="fas fa-hammer"></i> Rénovations
        </div>
        <div class="calculator-nav-item" onclick="window.location.href='mutation-tax.html'">
            <i class="fas fa-receipt"></i> Droits de Mutation
        </div>
        <div class="calculator-nav-item" onclick="window.location.href='mortgage.html'">
            <i class="fas fa-home"></i> Hypothèque
        </div>
    </div>

    <div class="container py-4">
        <div class="calculator-section" id="multi-napkin">
            <div class="card-header">
                <h2 class="text-white">Calculateur Napkin Multi (PAR)</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> La méthode "Napkin Multi" vous permet d'estimer rapidement la rentabilité potentielle d'un immeuble à revenus en utilisant seulement 3 données principales : le Prix d'achat, le nombre d'Appartements et les Revenus bruts.
                </div>
                
                <form id="multi-napkin-form">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label" for="purchase-price">Prix d'achat <i class="fas fa-question-circle info-tooltip" data-tooltip="Prix d'achat de l'immeuble"></i></label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="purchase-price" placeholder="0" min="0" step="1000" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label" for="num-apartments">Nombre d'appartements <i class="fas fa-question-circle info-tooltip" data-tooltip="Nombre total de logements dans l'immeuble"></i></label>
                                <input type="number" class="form-control" id="num-apartments" placeholder="0" min="1" step="1" required>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label" for="gross-income">Revenus bruts annuels <i class="fas fa-question-circle info-tooltip" data-tooltip="Revenus locatifs bruts annuels"></i></label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="gross-income" placeholder="0" min="0" step="1000" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-calculator"></i> Calculer la Rentabilité
                        </button>
                        <button type="button" id="calculate-offer" class="btn btn-success ms-2">
                            <i class="fas fa-hand-holding-usd"></i> Calculer l'Offre Optimale
                        </button>
                        <button type="reset" class="btn btn-secondary ms-2">
                            <i class="fas fa-redo"></i> Réinitialiser
                        </button>
                    </div>
                </form>
                
                <div class="result-container mt-4 d-none" id="results-section">
                    <h3>Résultats</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="result-box" id="cashflow-result-box">
                                <div class="result-title">Cashflow Annuel Total</div>
                                <div class="result-value" id="cashflow-value">0 $</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="result-box" id="door-result-box">
                                <div class="result-title">Cashflow Mensuel par Porte</div>
                                <div class="result-value" id="door-value">0 $</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="result-box">
                                <div class="result-title">Revenus Nets d'Opération (RNO)</div>
                                <div class="result-value" id="noi-value">0 $</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="result-box">
                                <div class="result-title">Taux de Capitalisation</div>
                                <div class="result-value" id="cap-rate-value">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-table-container mt-4">
                        <h4>Détail des Calculs</h4>
                        <table class="results-table">
                            <tr>
                                <th>Élément</th>
                                <th>Montant</th>
                            </tr>
                            <tr>
                                <td>Revenus Bruts Annuels</td>
                                <td id="detail-gross-income">0 $</td>
                            </tr>
                            <tr>
                                <td>- Dépenses d'Opération <span id="expense-percent">(0%)</span></td>
                                <td id="detail-expenses">0 $</td>
                            </tr>
                            <tr>
                                <td>= Revenus Nets d'Opération (RNO)</td>
                                <td id="detail-noi">0 $</td>
                            </tr>
                            <tr>
                                <td>- Financement (méthode HIGH-5)</td>
                                <td id="detail-financing">0 $</td>
                            </tr>
                            <tr>
                                <td><strong>= Cashflow Annuel</strong></td>
                                <td id="detail-cashflow">0 $</td>
                            </tr>
                            <tr>
                                <td><strong>Cashflow Mensuel par Porte</strong></td>
                                <td id="detail-door">0 $</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="result-container mt-4 d-none" id="offer-section">
                    <h3>Offre Optimale</h3>
                    
                    <div class="form-group mb-3">
                        <label class="form-label" for="target-cashflow">Cashflow Mensuel par Porte Visé <i class="fas fa-question-circle info-tooltip" data-tooltip="Le cashflow mensuel par porte que vous souhaitez obtenir"></i></label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="target-cashflow" value="75" min="0" step="5">
                            <button class="btn btn-primary" id="recalculate-offer">Recalculer</button>
                        </div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Prix d'Achat Maximal Recommandé</div>
                        <div class="result-value" id="offer-value">0 $</div>
                    </div>
                    
                    <div class="results-table-container mt-4">
                        <h4>Détail du Calcul</h4>
                        <table class="results-table">
                            <tr>
                                <th>Élément</th>
                                <th>Montant</th>
                            </tr>
                            <tr>
                                <td>Revenus Bruts Annuels</td>
                                <td id="offer-detail-gross-income">0 $</td>
                            </tr>
                            <tr>
                                <td>- Dépenses d'Opération <span id="offer-expense-percent">(0%)</span></td>
                                <td id="offer-detail-expenses">0 $</td>
                            </tr>
                            <tr>
                                <td>= Revenus Nets d'Opération (RNO)</td>
                                <td id="offer-detail-noi">0 $</td>
                            </tr>
                            <tr>
                                <td>- Cashflow Annuel Total Visé</td>
                                <td id="offer-detail-target-cashflow">0 $</td>
                            </tr>
                            <tr>
                                <td>= Financement Annuel Maximal</td>
                                <td id="offer-detail-max-financing">0 $</td>
                            </tr>
                            <tr>
                                <td><strong>= Prix d'Achat Maximal (méthode HIGH-5)</strong></td>
                                <td id="offer-detail-max-offer">0 $</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-4 bg-dark text-white">
        <div class="container text-center">
            <p>© 2025 ImmoCalcul. Tous droits réservés.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Formatage des montants en dollars canadiens
        function formatMoney(amount) {
            return new Intl.NumberFormat('fr-CA', { style: 'currency', currency: 'CAD' }).format(amount);
        }
        
        // Formatage des pourcentages
        function formatPercent(percent) {
            return new Intl.NumberFormat('fr-CA', { style: 'percent', minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(percent / 100);
        }
        
        // Déterminer le pourcentage de dépenses en fonction du nombre d'appartements
        function getExpensePercentage(numApartments) {
            if (numApartments <= 2) return 0.30; // 30%
            if (numApartments <= 4) return 0.35; // 35%
            if (numApartments <= 6) return 0.45; // 45%
            return 0.50; // 50% pour 7+ logements
        }
        
        // Calcul de la rentabilité selon la méthode Napkin Multi (PAR)
        function calculateRentability() {
            const purchasePrice = parseFloat(document.getElementById('purchase-price').value) || 0;
            const numApartments = parseInt(document.getElementById('num-apartments').value) || 0;
            const grossIncome = parseFloat(document.getElementById('gross-income').value) || 0;
            
            // Calcul du pourcentage de dépenses selon le nombre d'appartements
            const expensePercentage = getExpensePercentage(numApartments);
            
            // Calcul des dépenses d'opération
            const expenses = grossIncome * expensePercentage;
            
            // Calcul des revenus nets d'opération (RNO)
            const noi = grossIncome - expenses;
            
            // Calcul du financement selon la méthode HIGH-5
            const financing = purchasePrice * 0.005 * 12; // HIGH-5: 0.5% par mois * 12 mois
            
            // Calcul du cashflow annuel
            const cashflow = noi - financing;
            
            // Calcul du cashflow mensuel par porte
            const doorCashflow = numApartments > 0 ? cashflow / (numApartments * 12) : 0;
            
            // Calcul du taux de capitalisation (Cap Rate)
            const capRate = purchasePrice > 0 ? (noi / purchasePrice) * 100 : 0;
            
            // Mise à jour des résultats
            document.getElementById('cashflow-value').textContent = formatMoney(cashflow);
            document.getElementById('door-value').textContent = formatMoney(doorCashflow) + ' / mois';
            document.getElementById('noi-value').textContent = formatMoney(noi);
            document.getElementById('cap-rate-value').textContent = formatPercent(capRate);
            
            // Mise à jour du tableau détaillé
            document.getElementById('detail-gross-income').textContent = formatMoney(grossIncome);
            document.getElementById('expense-percent').textContent = `(${formatPercent(expensePercentage * 100)})`;
            document.getElementById('detail-expenses').textContent = formatMoney(expenses);
            document.getElementById('detail-noi').textContent = formatMoney(noi);
            document.getElementById('detail-financing').textContent = formatMoney(financing);
            document.getElementById('detail-cashflow').textContent = formatMoney(cashflow);
            document.getElementById('detail-door').textContent = formatMoney(doorCashflow) + ' / mois';
            
            // Affichage de la section des résultats
            document.getElementById('results-section').classList.remove('d-none');
            
            // Ajout d'une classe selon le cashflow (positif, négatif)
            const cashflowBox = document.getElementById('cashflow-result-box');
            const doorBox = document.getElementById('door-result-box');
            
            if (doorCashflow >= 75) {
                cashflowBox.className = 'result-box result-profit';
                doorBox.className = 'result-box result-profit';
            } else if (doorCashflow > 0) {
                cashflowBox.className = 'result-box result-neutral';
                doorBox.className = 'result-box result-neutral';
            } else {
                cashflowBox.className = 'result-box result-loss';
                doorBox.className = 'result-box result-loss';
            }
            
            return { 
                purchasePrice, 
                numApartments, 
                grossIncome, 
                expensePercentage, 
                expenses, 
                noi, 
                financing, 
                cashflow, 
                doorCashflow 
            };
        }
        
        // Calcul de l'offre optimale
        function calculateOffer() {
            const numApartments = parseInt(document.getElementById('num-apartments').value) || 0;
            const grossIncome = parseFloat(document.getElementById('gross-income').value) || 0;
            const targetDoorCashflow = parseFloat(document.getElementById('target-cashflow').value) || 0;
            
            // Calcul du pourcentage de dépenses selon le nombre d'appartements
            const expensePercentage = getExpensePercentage(numApartments);
            
            // Calcul des dépenses d'opération
            const expenses = grossIncome * expensePercentage;
            
            // Calcul des revenus nets d'opération (RNO)
            const noi = grossIncome - expenses;
            
            // Calcul du cashflow annuel total visé
            const targetAnnualCashflow = targetDoorCashflow * numApartments * 12;
            
            // Calcul du financement annuel maximum
            const maxFinancing = noi - targetAnnualCashflow;
            
            // Calcul du prix d'achat maximal (inversé de la méthode HIGH-5)
            const maxOffer = maxFinancing > 0 ? maxFinancing / (0.005 * 12) : 0;
            
            // Mise à jour des résultats
            document.getElementById('offer-value').textContent = formatMoney(maxOffer);
            
            // Mise à jour du tableau détaillé
            document.getElementById('offer-detail-gross-income').textContent = formatMoney(grossIncome);
            document.getElementById('offer-expense-percent').textContent = `(${formatPercent(expensePercentage * 100)})`;
            document.getElementById('offer-detail-expenses').textContent = formatMoney(expenses);
            document.getElementById('offer-detail-noi').textContent = formatMoney(noi);
            document.getElementById('offer-detail-target-cashflow').textContent = formatMoney(targetAnnualCashflow);
            document.getElementById('offer-detail-max-financing').textContent = formatMoney(maxFinancing);
            document.getElementById('offer-detail-max-offer').textContent = formatMoney(maxOffer);
            
            // Affichage de la section de l'offre
            document.getElementById('offer-section').classList.remove('d-none');
        }
        
        // Gestionnaire d'événement pour le formulaire
        document.getElementById('multi-napkin-form').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateRentability();
        });
        
        // Gestionnaire d'événement pour le bouton de calcul d'offre
        document.getElementById('calculate-offer').addEventListener('click', function() {
            const data = calculateRentability();
            if (data.numApartments > 0 && data.grossIncome > 0) {
                calculateOffer();
            } else {
                alert('Veuillez d\'abord remplir les champs Nombre d\'appartements et Revenus bruts annuels.');
            }
        });
        
        // Gestionnaire d'événement pour le bouton de recalcul d'offre
        document.getElementById('recalculate-offer').addEventListener('click', function() {
            calculateOffer();
        });
    </script>
</body>
</html>